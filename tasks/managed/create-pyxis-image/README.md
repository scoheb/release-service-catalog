# create-pyxis-image

Tekton task that pushes metadata to Pyxis for all container images contained in a snapshot that is the
result of the `apply-mapping` task. It first extracts the containerImages from the snapshot, then runs
`skopeo inspect` on each, before finally pushing metadata to Pyxis.

The relative path of the pyxis.json file in the data workspace is output as a task result named
`pyxisDataPath`.

## Parameters

| Name                    | Description                                                                                                                                                                                                                                                                                                                                                                                                | Optional | Default value           |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|-------------------------|
| server                  | The server type to use. Options are 'production','production-internal,'stage-internal' and 'stage'                                                                                                                                                                                                                                                                                                         | Yes      | production              |
| concurrentLimit         | The maximum number of components to be processed at once                                                                                                                                                                                                                                                                                                                                                   | Yes      | 16                      |
| pyxisSecret             | The kubernetes secret to use to authenticate to Pyxis. It needs to contain two keys: key and cert                                                                                                                                                                                                                                                                                                          | No       | -                       |
| certified               | If set to true, the images will be marked as certified in their Pyxis entries                                                                                                                                                                                                                                                                                                                              | Yes      | false                   |
| isLatest                | If set to true, the images will have a latest tag added with their Pyxis entries                                                                                                                                                                                                                                                                                                                           | Yes      | false                   |
| rhPush                  | If set to true, an additional entry will be created in ContainerImage.repositories with the registry and repository fields converted to use Red Hat's official registry. E.g. a mapped repository of "quay.io/redhat-pending/product---my-image" will be converted to use registry "registry.access.redhat.com" and repository "product/my-image". Also, this repository entry will be marked as published | Yes      | false                   |
| snapshotPath            | Path to the JSON string of the mapped Snapshot spec in the data workspace                                                                                                                                                                                                                                                                                                                                  | No       | -                       |
| dataPath                | Path to the JSON string of the merged data to use in the data workspace                                                                                                                                                                                                                                                                                                                                    | No       | -                       |
| ociStorage              | The OCI repository where the Trusted Artifacts are stored                                                                                                                                                                                                                                                                                                                                                  | Yes      | empty                   |
| ociArtifactExpiresAfter | Expiration date for the trusted artifacts created in the OCI repository. An empty string means the artifacts do not expire                                                                                                                                                                                                                                                                                 | Yes      | 1d                      |
| trustedArtifactsDebug   | Flag to enable debug logging in trusted artifacts. Set to a non-empty string to enable                                                                                                                                                                                                                                                                                                                     | Yes      | ""                      |
| orasOptions             | oras options to pass to Trusted Artifacts calls                                                                                                                                                                                                                                                                                                                                                            | Yes      | ""                      |
| sourceDataArtifact      | Location of trusted artifacts to be used to populate data directory                                                                                                                                                                                                                                                                                                                                        | Yes      | ""                      |
| dataDir                 | The location where data will be stored                                                                                                                                                                                                                                                                                                                                                                     | Yes      | $(workspaces.data.path) |
| taskGitUrl              | The url to the git repo where the release-service-catalog tasks and stepactions to be used are stored                                                                                                                                                                                                                                                                                                      | No       | -                       |
| taskGitRevision         | The revision in the taskGitUrl repo to be used                                                                                                                                                                                                                                                                                                                                                             | No       | -                       |
